{% extends "main/base/single_column.html" %}
{% load lorem from poleno_utils %}

{% block title %}E-mail Addresses | {{ block.super }}{% endblock %}

{% block main_col %}
  <h1>E-mail Addresses</h1>
  {% include "main/snippets/messages.html" %}
  {% if user.emailaddress_set.all %}
    <p>The following e-mail addresses are associated with your account:</p>
    <form class="form-horizontal" method="post" action="{% url 'account_email' %}">
      {% csrf_token %}
      <div class="control-group">
        <div class="controls">
          {% for emailaddress in user.emailaddress_set.all %}
            <label class="{% if not emailaddress.verified %}muted{%endif%} radio">
              <input type="radio" name="email" {% if emailaddress.primary %}checked="checked"{%endif %} value="{{emailaddress.email}}">
              {{ emailaddress.email }}
              {% if emailaddress.verified %}
                <span class="text-success">Verified</span>
              {% else %}
                <span class="text-error">Unverified</span>
              {% endif %}
              {% if emailaddress.primary %}
                <span class="text-info">Primary</span>
              {% endif %}
            </label>
          {% endfor %}
        </div>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn btn-primary" name="action_primary">Make Primary</button>
        <button type="submit" class="btn" name="action_send">Re-send Verification</button>
        <button type="submit" class="btn" name="action_remove">Remove</button>
      </div>
    </form>
  {% else %}
    <p><strong>Warning:</strong> You currently do not have any e-mail address set up. You should really add an e-mail address so you can receive notifications, reset your password, etc.</p>
  {% endif %}

  <h3>Add E-mail Address</h3>
  <p>{% lorem 32 %}</p>
  <form class="form-horizontal" method="post" action=".">
    {% csrf_token %}
    {% include "main/snippets/form_horizontal.html" with form=form %}
    <div class="form-actions">
      <button type="submit" class="btn btn-primary" name="action_add">Add E-mail</button>
    </div>
  </form>
{% endblock %}


{% block javascript %}{{ block.super }}
  <script>
    (function() {
      var message = 'Do you really want to remove the selected e-mail address?';
      var actions = document.getElementsByName('action_remove');
      if (actions.length) {
        actions[0].addEventListener("click", function(e) {
          if (! confirm(message)) {
            e.preventDefault();
          }
        });
      }
    })();
  </script>
{% endblock %}

{# vim: set filetype=htmldjango :#}
{% load static from staticfiles %}
{% load addtoblock render_block from sekizai_tags %}

{% comment %}
 %
 % Context:
 %  -- None
 %
{% endcomment %}

{% addtoblock "css" %}<link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" rel="stylesheet">{% endaddtoblock %}
{% addtoblock "css" %}<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">{% endaddtoblock %}
{% addtoblock "js" %}<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>{% endaddtoblock %}

{% comment %}
{% addtoblock "css" %}<link href="{% static "main/3part/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" %}" rel="stylesheet">{% endaddtoblock %}
{% addtoblock "css" %}<link href="{% static "main/3part/bootstrap/2.3.2/css/bootstrap-combined.min.css" %}" rel="stylesheet">{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static "main/3part/jquery/1.10.2/jquery.min.js" %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static "main/3part/jqueryui/1.10.3/jquery-ui.min.js" %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static "main/3part/bootstrap/2.3.2/js/bootstrap.min.js" %}"></script>{% endaddtoblock %}
{% endcomment %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:"en" }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Chcem Vedie≈•{% endblock %}</title>
    {% render_block "css" %}
  </head>
  <body>
    <header>
      {% include "main/snippets/header.html" %}
    </header>
    <div class="container">
      {% include "main/snippets/messages.html" %}
      {% block container %}{% endblock %}
    </div>
    <footer class="container">
      <hr>
      {% include "main/snippets/footer.html" %}
    </footer>
    {% render_block "js" %}
  </body>
</html>

{% addtoblock "css" %}{# {{{ #}
  <style>
	@media (min-width: 980px) { body { padding-top: 60px; } }
	.brand.active { color: white; }
  </style>
{% endaddtoblock %}{# }}} #}

{% addtoblock "js" %}{# {{{ #}
  <script>
	/* Scrolls to selected element. If there is no such element, do nothing.
	 *
	 * Example:
	 *     $('#element').scrollTo()
	 */
	$(function(){
		$.fn.scrollTo = function(){
			if (this.length) {
				var skip = parseInt($('body').css('padding-top'));
				var top = this.offset().top - skip;
				$('html, body').animate({
					scrollTop: top
				}, 200);
			}
		};
	});

	/* Bootstrap modals are animated. This function closes any open modals, waits for the
	 * animation and then call the given callback.
	 *
	 * Example:
	 *     $.hideBootstrapModal(function(){ console.log('Modals closed.'); });
	 */
	$(function(){
		$.hideBootstrapModal = function(then){
			if ($('.modal.in').length) {
				$('body').on('hidden.hideBootstrapModal', '.modal', function(){
					$('body').off('.hideBootstrapModal');
					then();
				});
				$('.modal.in').modal('hide');
			} else {
				then();
			}
		};
	});

	/* Intercepts clicks on elements with class ``confirm`` and asks user if he is sure he
	 * wants to proceed. Question to ask is read from ``data-confirm``.
	 *
	 * This function must be defined before any other function attaching handlers to events
	 * we need to prevent if the user decides not to proceed.
	 *
	 * Example:
	 *     <button type="submit" class="confirm" data-confirm="Are you sure?">Submit</button>
	 */
	$(function(){
		$('.confirm').click(function(event){
			var message = $(this).data('confirm');
			if (!confirm(message)) {
				event.preventDefault();
				event.stopImmediatePropagation();
			}
		});
	});

	/* Makes every link with class ``post`` send POST request to its href URL when clicked.
	 * Data for the request may be supplied by ``data-post-*`` element attributes.
	 *
	 * Example:
	 *     <a href="/path/to/location" class="post" data-post-name="value">...</a>
	 */
	$(function(){
		$('a.post').click(function(event){
			event.preventDefault();
			var form = $('<form action="" method="post" style="display: none;"></form>');
			form.attr('action', $(this).attr('href'));

			$.each(this.attributes, function(){
				if (this.name.substring(0, 10) == "data-post-") {
					var input = $('<input type="hidden" name="" value="">');
					input.attr('name', this.name.substring(10));
					input.attr('value', this.value);
					input.appendTo(form);
				}
			});

			form.appendTo('body');
			form.submit();
		});
	});

	/* Performs AJAX call expecting JDOT (JSON DOM Transition) response generated by
	 * ``poleno.utils.http.Jdot``. It's a list of simple javascript snippents to transform the
	 * page.
	 *
	 * Example:
	 *     <form class="jdot" method="post" action="...">...</form>
	 *     <button class="jdot" action="...">...</button>
	 *     <a class="jdot" href="..." method="post">...</a>
	 *
	 * FIXME: Deprecated?
	 */
	$(function(){
		function handler(event){
			event.preventDefault();
			$.ajax({
				type: $(this).attr('method') || 'get',
				url: $(this).attr('action') || $(this).attr('href'),
				data: $(this).serialize(),
				dataType: 'json',
			}).done(function(data){
				for (var i = 0; i < data.jdot.length; i++) {
					(function(args){ eval(data.jdot[i].js); })(data.jdot[i].args);
				}
			});
		}
		$(document).on('submit', 'form.jdot', handler);
		$(document).on('click', ':not(form).jdot', handler);
	});

	/* Performs AJAX request when clicking on an element or submitting a form. Response data
	 * are returned by ``ajax-done`` event which is triggered on the element when the request
	 * finishes.
	 *
	 * Classes:
	 *     ``ajax``: Add to forms or other elements you with to perform AJAX requests
	 *     ``ajax-once``: In addition to ``ajax`` class add this class to perform the request
	 *             only once.
	 *
	 * Attributes:
	 *     ``method``: Set HTTP method used for the request, e.g. "POST". If not specified
	 *             GET method is used.
	 *     ``action``, ``href``: Set request url.
	 *     ``data-type``: Set AJAX response data type, e.g. "json" or "html".
	 *     ``data-target``: If ``data-type`` is "html" insert response data into element
	 *             selected by ``data-target``.
	 *
	 * Example:
	 *     <form class="ajax" method="post" action="...">...</form>
	 *     <button class="ajax" action="...">...</button>
	 *     <a class="ajax" href="..." method="post">...</a>
	 *
	 *     $('form').on('ajax-done', function(event, data){...})
	 *
	 *     <button class="ajax" action="..." data-type="html" data-target="#target">...</button>
	 *     <div id="target">Replace this content</div>
	 */
	$(function(){
		function handler(event){
			event.preventDefault();
			var type = $(this).attr('method') || 'get';
			var url = $(this).attr('action') || $(this).attr('href');
			var data = $(this).serialize();
			var dataType = $(this).data('type') || 'json';
			var target = $(this).data('target');
			var once = $(this).hasClass('ajax-once');
			var that = this;
			$.ajax({
				type: type,
				url: url,
				data: data,
				dataType: dataType
			}).done(function(data){
				$(that).trigger('ajax-done', [data]);
				if (dataType == 'html') {
					$(target).html(data);
				}
				if (once) {
					$(that).removeClass('ajax ajax-once');
				}
			});
		}
		$(document).on('submit', 'form.ajax', handler);
		$(document).on('click', ':not(form).ajax', handler);
	});

  </script>
{% endaddtoblock %}{# }}} #}


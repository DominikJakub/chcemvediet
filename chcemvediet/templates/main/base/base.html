{# vim: set filetype=htmldjango :#}
{% load static from staticfiles %}
{% load addtoblock render_block from sekizai_tags %}

{% comment %}
 %
 % Context:
 %  -- None
 %
{% endcomment %}

{# JQuery #}
{% addtoblock "js" %}<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>{% endaddtoblock %}

{# JQuery UI #}
{% addtoblock "css" %}<link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" rel="stylesheet">{% endaddtoblock %}
{% addtoblock "js" %}<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static 'main/3part/jqueryui/1.10.3/datepicker-sk.js' %}"></script>{% endaddtoblock %}

{# Bootstrap #}
{% addtoblock "css" %}<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">{% endaddtoblock %}
{% addtoblock "js" %}<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>{% endaddtoblock %}



{% comment %}
{% addtoblock "css" %}<link href="{% static "main/3part/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" %}" rel="stylesheet">{% endaddtoblock %}
{% addtoblock "css" %}<link href="{% static "main/3part/bootstrap/2.3.2/css/bootstrap-combined.min.css" %}" rel="stylesheet">{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static "main/3part/jquery/1.10.2/jquery.min.js" %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static "main/3part/jqueryui/1.10.3/jquery-ui.min.js" %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}<script src="{% static "main/3part/bootstrap/2.3.2/js/bootstrap.min.js" %}"></script>{% endaddtoblock %}
{% endcomment %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:"en" }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Chcem Vedie≈•{% endblock %}</title>
    {% render_block "css" %}
  </head>
  <body>
    <header>
      {% include "main/snippets/header.html" %}
    </header>
    <div class="container">
      {% include "main/snippets/messages.html" %}
      {% block container %}{% endblock %}
    </div>
    <footer class="container">
      <hr>
      {% include "main/snippets/footer.html" %}
    </footer>
    {% render_block "js" %}
  </body>
</html>

{% addtoblock "css" %}{# {{{ #}
  <style>
	/* Make sure fixed menu won't overlap page top. */
	@media (min-width: 980px) { body { padding-top: 60px; } }

	/* Some tweaks for Bootstrap. */
	.brand.active { color: white; }
	.well-inverse { background-color: white; }
	.suppressed-control { padding: 5px; height: 20px; line-height: 20px; display: inline-block; vertical-align: center; }

	/* Large Bootstrap modals */
	@media (min-width: 768px) { .modal.modal-large { width: 660px; margin-left: -330px; } }
	@media (min-width: 980px) { .modal.modal-large { width: 870px; margin-left: -435px; } }
	@media (min-width: 1200px) { .modal.modal-large { width: 1100px; margin-left: -550px; } }

	/* Naive workaround for responsive tall modals */
	@media (min-height: 650px) { .modal-body { max-height: 450px; } }
	@media (min-height: 700px) { .modal-body { max-height: 500px; } }
	@media (min-height: 750px) { .modal-body { max-height: 550px; } }
	@media (min-height: 800px) { .modal-body { max-height: 600px; } }
	@media (min-height: 850px) { .modal-body { max-height: 650px; } }
	@media (min-height: 900px) { .modal-body { max-height: 700px; } }
	@media (min-height: 950px) { .modal-body { max-height: 750px; } }
	@media (min-height: 1000px) { .modal-body { max-height: 800px; } }
	@media (min-width: 768px) and (min-height: 750px) { .modal-body { max-height: 450px; } }
	@media (min-width: 768px) and (min-height: 800px) { .modal-body { max-height: 500px; } }
	@media (min-width: 768px) and (min-height: 850px) { .modal-body { max-height: 550px; } }
	@media (min-width: 768px) and (min-height: 900px) { .modal-body { max-height: 600px; } }
	@media (min-width: 768px) and (min-height: 950px) { .modal-body { max-height: 650px; } }
	@media (min-width: 768px) and (min-height: 1000px) { .modal-body { max-height: 700px; } }

	/* Loading icon and fixing z-index for JQuery Autocomplete */
	.ui-autocomplete-loading { background: white url("{% static 'main/images/ui-anim_basic_16x16.gif' %}") right center no-repeat; }
	.ui-autocomplete { z-index: 1100 !important; /* Must be higher than 1050, what's Bootstrap modal z-index. */ }

	/* For chcemvediet.apps.obligees.forms.ObligeeWithAddressInput */
	.obligee_with_address_input { display: inline-block; vertical-align: top; }
	.obligee_with_address_input ~ .help-inline { padding-top: 5px; }
	.obligee_with_address_input_details { padding: 10px 0px 0px 5px; }
	.obligee_with_address_input_hide { display: none; }
  </style>
{% endaddtoblock %}{# }}} #}

{% addtoblock "js" %}{# {{{ #}
  <script>
	/* Scrolls to selected element. If there is no such element, do nothing.
	 *
	 * Example:
	 *     $('#element').scrollTo()
	 */
	$(function(){
		$.fn.scrollTo = function(){
			if (this.length) {
				var skip = parseInt($('body').css('padding-top'));
				var top = this.offset().top - skip;
				$('html, body').animate({
					scrollTop: top
				}, 200);
			}
		};
	});

	/* Bootstrap modals are animated. This function closes any open modals, waits for the
	 * animation and then call the given callback.
	 *
	 * Example:
	 *     $.hideBootstrapModal(function(){ console.log('Modals closed.'); });
	 */
	$(function(){
		$.hideBootstrapModal = function(then){
			if ($('.modal.in').length) {
				$('body').on('hidden.hideBootstrapModal', '.modal', function(){
					$('body').off('.hideBootstrapModal');
					then();
				});
				$('.modal.in').modal('hide');
			} else {
				then();
			}
		};
	});

	/* Intercepts clicks on elements with class ``confirm`` and asks user if he is sure he
	 * wants to proceed. Question to ask is read from ``data-confirm``.
	 *
	 * This function must be defined before any other function attaching handlers to events
	 * we need to prevent if the user decides not to proceed.
	 *
	 * Example:
	 *     <button type="submit" class="confirm" data-confirm="Are you sure?">Submit</button>
	 */
	$(function(){
		$('.confirm').click(function(event){
			var message = $(this).data('confirm');
			if (!confirm(message)) {
				event.preventDefault();
				event.stopImmediatePropagation();
			}
		});
	});

	/* Makes every link with class ``post`` send POST request to its href URL when clicked.
	 * Data for the request may be supplied by ``data-post-*`` element attributes.
	 *
	 * Example:
	 *     <a href="/path/to/location" class="post" data-post-name="value">...</a>
	 */
	$(function(){
		$('a.post').click(function(event){
			event.preventDefault();
			var form = $('<form action="" method="post" style="display: none;"></form>');
			form.attr('action', $(this).attr('href'));

			$.each(this.attributes, function(){
				if (this.name.substring(0, 10) == "data-post-") {
					var input = $('<input type="hidden" name="" value="">');
					input.attr('name', this.name.substring(10));
					input.attr('value', this.value);
					input.appendTo(form);
				}
			});

			form.appendTo('body');
			form.submit();
		});
	});

	/* Attaches JQuery Datepicker to all elements (usually input boxes) with class
	 * ``datepicker``. Datepicker is attached when the user focuses the element for the first
	 * time. We cannot just attach it to elements with correct class when the page loads,
	 * because some elements may be inserted to the page later, e.g. with AJAX. The Datepicker
	 * is configured to have current locale.
	 *
	 * Example:
	 *     <input type="text" class="datepicker" value="12/31/2014">
	 */
	$(function(){
		$(document).on('focus', '.datepicker', function(event){
			if (!$(this).hasClass('hasDatepicker')) {
				var lang = $('html').attr('lang');
				$(this).datepicker($.datepicker.regional[lang == 'en' ? '' : lang]);
				$(this).datepicker('show');
			}
		});
	});

	/* Attaches JQuery Autocomplete to all elements (usually input boxes) with class
	 * ``autocomplete``. Autocomplete is attached when the user focuses the element for the
	 * first time. We cannot just attach it to elements with correct class when the page loads,
	 * because some elements may be inserted to the page later, e.g. with AJAX. Autocomplete
	 * source url must be given in ``data-autocomplete-url`` attribute.
	 *
	 * Example:
	 *     <input type="text" class="autocomplete" data-autocomplete-url="/autocomplete/url">
	 */
	$(function(){
		$(document).on('focus', '.autocomplete', function(event){
			if (!$(this).hasClass('ui-autocomplete-input')) {
				var source = $(this).data('autocomplete-url');
				$(this).autocomplete({
					source: source,
					minLength: 2
				});
			} else {
				$(this).autocomplete("search");
			}
		});
	});

	/* Attaches ObligeeWithAddressInput to JQuery Autocomplete events and updates Obligee
	 * details whenever the user selects a new Obligee.
	 */
	$(function(){
		function handler(event, ui){
			if (ui.item) {
				var obligee = ui.item.obligee;
				$('.obligee_with_address_input_street', this).text(obligee.street);
				$('.obligee_with_address_input_zip', this).text(obligee.zip);
				$('.obligee_with_address_input_city', this).text(obligee.city);
				$('.obligee_with_address_input_email', this).text(obligee.email);
				$('.obligee_with_address_input_details', this).show();
			} else {
				$('.obligee_with_address_input_details', this).hide();
			}
		}
		$(document).on('autocompleteselect', '.obligee_with_address_input', handler);
		$(document).on('autocompletechange', '.obligee_with_address_input', handler);
	});

	/* Performs AJAX call expecting JDOT (JSON DOM Transition) response generated by
	 * ``poleno.utils.http.Jdot``. It's a list of simple javascript snippents to transform the
	 * page.
	 *
	 * Example:
	 *     <form class="jdot" method="post" action="...">...</form>
	 *     <button class="jdot" action="...">...</button>
	 *     <a class="jdot" href="..." method="post">...</a>
	 *
	 * FIXME: Deprecated?
	 */
	$(function(){
		function handler(event){
			event.preventDefault();
			$.ajax({
				type: $(this).attr('method') || 'get',
				url: $(this).attr('action') || $(this).attr('href'),
				data: $(this).serialize(),
				dataType: 'json',
			}).done(function(data){
				for (var i = 0; i < data.jdot.length; i++) {
					(function(args){ eval(data.jdot[i].js); })(data.jdot[i].args);
				}
			});
		}
		$(document).on('submit', 'form.jdot', handler);
		$(document).on('click', ':not(form).jdot', handler);
	});

	/* Performs AJAX request when clicking on an element or submitting a form. Response data
	 * are returned by ``ajax-done`` event which is triggered on the element when the request
	 * finishes.
	 *
	 * Classes:
	 *     ``ajax``: Add to forms or other elements you with to perform AJAX requests
	 *     ``ajax-once``: In addition to ``ajax`` class add this class to perform the request
	 *             only once.
	 *
	 * Attributes:
	 *     ``method``: Set HTTP method used for the request, e.g. "POST". If not specified
	 *             GET method is used.
	 *     ``action``, ``href``: Set request url.
	 *     ``data-type``: Set AJAX response data type, e.g. "json" or "html".
	 *     ``data-target``: If ``data-type`` is "html" insert response data into element
	 *             selected by ``data-target``.
	 *
	 * Example:
	 *     <form class="ajax" method="post" action="...">...</form>
	 *     <button class="ajax" action="...">...</button>
	 *     <a class="ajax" href="..." method="post">...</a>
	 *
	 *     $('form').on('ajax-done', function(event, data){...})
	 *
	 *     <button class="ajax" action="..." data-type="html" data-target="#target">...</button>
	 *     <div id="target">Replace this content</div>
	 */
	$(function(){
		function handler(event){
			event.preventDefault();
			var type = $(this).attr('method') || 'get';
			var url = $(this).attr('action') || $(this).attr('href');
			var data = $(this).serialize();
			var dataType = $(this).data('type') || 'json';
			var target = $(this).data('target');
			var once = $(this).hasClass('ajax-once');
			var that = this;
			$.ajax({
				type: type,
				url: url,
				data: data,
				dataType: dataType
			}).done(function(data){
				$(that).trigger('ajax-done', [data]);
				if (dataType == 'html') {
					$(target).html(data);
				}
				if (once) {
					$(that).removeClass('ajax ajax-once');
				}
			});
		}
		$(document).on('submit', 'form.ajax', handler);
		$(document).on('click', ':not(form).ajax', handler);
	});

  </script>
{% endaddtoblock %}{# }}} #}


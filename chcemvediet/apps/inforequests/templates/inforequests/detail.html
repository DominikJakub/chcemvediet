{% extends "main/base/single_column.html" %}
{% load blocktrans from i18n %}
{% load lorem from poleno.utils %}

{% block title %}{% blocktrans %}Inforequest Detail{% endblocktrans %} | {{ block.super }}{% endblock %}

{% block main_col %}
  <h1>{% blocktrans %}Inforequest Detail{% endblocktrans %}</h1>
  <div class="row">
    <p class="span2 text-right">{% blocktrans %}Applicant{% endblocktrans %}:</p>
    <div class="span10">
      <p>{{ inforequest.applicant_name }}</p>
      <p>{{ inforequest.applicant_street }}<br>
        {{ inforequest.applicant_zip }} {{ inforequest.applicant_city }}</p>
    </div>
  </div>
  <div class="row">
    <p class="span2 text-right">{% blocktrans %}Obligee{% endblocktrans %}:</p>
    <div class="span10">
      <p>{{ inforequest.history.obligee_name }}</p>
      <p>{{ inforequest.history.obligee_street }}<br>
        {{ inforequest.history.obligee_zip }} {{ inforequest.history.obligee_city }}</p>
    </div>
  </div>
  <div class="row">
    <p class="span2 text-right">{% blocktrans %}Unique E-mail{% endblocktrans %}:</p>
    <p class="span10">{{ inforequest.unique_email }}</p>
  </div>
  <div class="row">
    <p class="span2 text-right">{% blocktrans %}Submission Date{% endblocktrans %}:</p>
    <p class="span10">{{ inforequest.submission_date }}</p>
  </div>
  {% for action in inforequest.history.action_set.all %}
    <div id="action-{{ action.id }}">
      <h2>{{ action.get_type_display }}</h2>
      <div class="row">
        <p class="span2 text-right">{% blocktrans %}Effective Date{% endblocktrans %}:</p>
        <p class="span10">{{ action.effective_date }}</p>
      </div>
      <div class="row">
        <p class="span2 text-right">{% blocktrans %}Subject{% endblocktrans %}:</p>
        <p class="span10">{{ action.subject }}</p>
      </div>
      <div class="row">
        <p class="span12" style="white-space: pre-line;">{{ action.content }}</p>
      </div>
    </div>
  {% endfor %}

  {# Undecided E-mails#}
  {% for email in inforequest.receivedemail_set.undecided %}
    {% if forloop.first %}
      <h2 id="undecided">{% blocktrans %}Undecided Received E-mail{% endblocktrans %}</h2>
      <div id="undecided-first">
    {% elif forloop.counter == 2 %}
      </div>
      <div class="alert alert-info alert-block clearfix">
        <h4>More e-mails</h4>
        <p>{% blocktrans with forloop.revcounter as count %}{{ count }} other e-mails are waiting for your decision. First decide the above e-mail and then the rest. You must decide them in the order they were received.{% endblocktrans %}</p>
        <p><button class="btn" data-toggle="collapse" data-target="#undecided-rest">{% blocktrans %}Show them{% endblocktrans %}</button></p>
      </div>
      <div id="undecided-rest" class="collapse">
    {% endif %}
        <div class="well">
          <div class="row-fluid">
            <p class="span2 text-right">{% blocktrans %}Subject{% endblocktrans %}:</p>
            <p class="span10">{{ email.raw_email.subject }}</p>
          </div>
          <div class="row-fluid">
            <p class="span2 text-right">{% blocktrans %}From{% endblocktrans %}:</p>
            <p class="span10">{{ email.raw_email.from_header }}</p>
          </div>
          <div class="row-fluid">
            <p class="span2 text-right">{% blocktrans %}To{% endblocktrans %}:</p>
            <p class="span10">{{ email.raw_email.to_header }}</p>
          </div>
          <div class="row-fluid">
            <p class="span2 text-right">{% blocktrans %}Received{% endblocktrans %}:</p>
            <p class="span10">{{ email.raw_email.processed }}</p>
          </div>
          <div class="row-fluid">
            <p class="span12" style="white-space: pre-line;">{{ email.raw_email.text }}</p>
          </div>
          {% if forloop.first %}
            <h4>{% blocktrans %}Please, read the e-mail and decide what it is:{% endblocktrans %}</h4>
            <div class="btn-group">
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#decide-email-confirmation-modal">{% blocktrans %}Confirmation{% endblocktrans %}</button>
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#decide-email-extension-modal">{% blocktrans %}Extension{% endblocktrans %}</button>
              <button type="button" class="btn" disabled>{% blocktrans %}Advancement{% endblocktrans %}</button>
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#decide-email-clarification-request-modal">{% blocktrans %}Clarification Request{% endblocktrans %}</button>
              <button type="button" class="btn" disabled>{% blocktrans %}Disclosure{% endblocktrans %}</button>
              <button type="button" class="btn" disabled>{% blocktrans %}Refusal{% endblocktrans %}</button>
            </div>
            <div class="btn-group">
              <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#decide-email-unrelated-modal">{% blocktrans %}Unrelated e-mail, or SPAM{% endblocktrans %}</button>
            </div>
            <div class="btn-group">
              <button type="button" class="btn btn-inverse" data-toggle="modal" data-target="#decide-email-unknown-modal">{% blocktrans %}I don't know{% endblocktrans %}</button>
            </div>
            {# Confirmation #}
            <div id="decide-email-confirmation-modal" class="modal hide fade">
              <form method="post" action="{% url 'inforequests:decide_email' inforequest.id email.id %}">
                {% csrf_token %}
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h3>{% blocktrans %}Inforequest Confirmation{% endblocktrans %}</h3>
                </div>
                <div class="modal-body">
                  {% if inforequest.history.action_set.confirmations.count %}
                    <div class="alert">{% blocktrans %}<strong>Warning!</strong> There already is a confirmation in this inforequest history. Obligees usually don't send multiplne confirmations.{% endblocktrans %}</div>
                  {% endif %}
                  <p>{% blocktrans %}Are you sure you want to mark this e-mail as a confirmation of your inforequest?{% endblocktrans %}</p>
                  <p>[{% lorem 7 %}]</p>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary" name="operation" value="confirmation">{% blocktrans %}Mark as Inforequest Confirmation{% endblocktrans %}</button>
                  <button type="button" class="btn" data-dismiss="modal">{% blocktrans %}Close{% endblocktrans %}</button>
                </div>
              </form>
            </div>
            {# Extension #}
            <div id="decide-email-extension-modal" class="modal hide fade">
              <form method="post" action="{% url 'inforequests:decide_email' inforequest.id email.id %}">
                {% csrf_token %}
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h3>{% blocktrans %}Deadline Extension{% endblocktrans %}</h3>
                </div>
                <div class="modal-body">
                  {% if inforequest.history.action_set.extensions.count %}
                    <div class="alert">{% blocktrans %}<strong>Warning!</strong> There already is a deadline extension in this inforequest history. Obligees usually don't send multiplne deadline extensions.{% endblocktrans %}</div>
                  {% endif %}
                  <p>{% blocktrans %}Are you sure you want to mark this e-mail as a deadline extension of your inforequest?{% endblocktrans %}</p>
                  <p>[{% lorem 7 %}]</p>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary" name="operation" value="extension">{% blocktrans %}Mark as Deadline Extension{% endblocktrans %}</button>
                  <button type="button" class="btn" data-dismiss="modal">{% blocktrans %}Close{% endblocktrans %}</button>
                </div>
              </form>
            </div>
            {# Clarification Request #}
            <div id="decide-email-clarification-request-modal" class="modal hide fade">
              <form method="post" action="{% url 'inforequests:decide_email' inforequest.id email.id %}">
                {% csrf_token %}
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h3>{% blocktrans %}Clarification Request{% endblocktrans %}</h3>
                </div>
                <div class="modal-body">
                  <p>{% blocktrans %}Are you sure you want to mark this e-mail as a clarification request?{% endblocktrans %}</p>
                  <p>[{% lorem 7 %}]</p>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary" name="operation" value="clarification-request">{% blocktrans %}Mark as Clarification Request{% endblocktrans %}</button>
                  <button type="button" class="btn" data-dismiss="modal">{% blocktrans %}Close{% endblocktrans %}</button>
                </div>
              </form>
            </div>
            {# Unrelated #}
            <div id="decide-email-unrelated-modal" class="modal hide fade">
              <form method="post" action="{% url 'inforequests:decide_email' inforequest.id email.id %}">
                {% csrf_token %}
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h3>{% blocktrans %}Unrelated E-mail{% endblocktrans %}</h3>
                </div>
                <div class="modal-body">
                  <p>{% blocktrans %}Are you sure you want to mark this e-mail as unrelated, or as a SPAM?{% endblocktrans %}</p>
                  <p>[{% lorem 7 %}]</p>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary" name="operation" value="unrelated">{% blocktrans %}Mark as Unrelated{% endblocktrans %}</button>
                  <button type="button" class="btn" data-dismiss="modal">{% blocktrans %}Close{% endblocktrans %}</button>
                </div>
              </form>
            </div>
            {# Unknown #}
            <div id="decide-email-unknown-modal" class="modal hide fade">
              <form method="post" action="{% url 'inforequests:decide_email' inforequest.id email.id %}">
                {% csrf_token %}
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h3>{% blocktrans %}I don't Know, What This E-mail Is{% endblocktrans %}</h3>
                </div>
                <div class="modal-body">
                  <p>{% blocktrans %}Are you sure you don't know how to decide and you want ask our admin for help?{% endblocktrans %}</p>
                  <p>[{% lorem 7 %}]</p>
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary" name="operation" value="unknown">{% blocktrans %}Ask Admin for Help{% endblocktrans %}</button>
                  <button type="button" class="btn" data-dismiss="modal">{% blocktrans %}Close{% endblocktrans %}</button>
                </div>
              </form>
            </div>
          {% endif %}
        </div>
    {% if forloop.last %}
      </div>
    {% endif %}
  {% endfor %}
  <hr>
  <p>
    <a class="btn" href="{% url 'inforequests:index' %}">{% blocktrans %}Inforequest List{% endblocktrans %}</a>
  </p>
{% endblock %}
